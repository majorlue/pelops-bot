// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Tower {
  theme  String // Tower Theme eg. Prometheus
  week   Int // Week # of the year 1-52
  floors Floor[] // Array of floors and their encounters

  // Defining unique constraint to be combination of theme/week
  @@id([theme, week])
}

model Floor {
  number     Int      @id // Floor number 1-50
  guardians  String[] // Array of primary fight sprite
  strays     String[] // Array of primary fight sprite
  puzzles    String[] // Array of puzzle type, difficulty
  chests     String[] // Array of chest bufftype/key
  // Relation to Theme/Week
  tower      Tower    @relation(fields: [towerTheme, towerWeek], references: [theme, week])
  towerTheme String
  towerWeek  Int
}

model Encounter {
  leader        String         @id // Monster sprite, as it shows on map
  leaderMonster Monster        @relation(fields: [leader], references: [name])
  tier          Int // Minimum encounter tier (9, 10)
  monsters      MonsterCount[] // Array of monsters in this encounter (incl. leader)
}

// Monster name/count definition for encounters
model MonsterCount {
  id              String     @default(uuid())
  monsterName     String // Monster name
  count           Int // Number of the above monster
  monster         Monster    @relation(fields: [monsterName], references: [name])
  encounter       Encounter? @relation(fields: [encounterLeader], references: [leader])
  encounterLeader String?

  @@id([monsterName, count])
}

model Monster {
  name         String         @id // Monster name
  berserk      Boolean        @default(false) // Is berserk?
  statuses     String[] // Starts with buffs/debuffs/statuses?
  monsterCount MonsterCount[]
  encounter    Encounter[]
}
